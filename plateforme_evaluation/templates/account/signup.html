{% extends "base.html" %}

{% block title %}Création de compte - Plateforme d'Évaluation{% endblock %}

{% block content %}
<div class="max-w-md mx-auto px-4 py-8">
    <div class="bg-white shadow-lg rounded-lg overflow-hidden">
        <!-- Menu simple -->
        <div class="bg-gray-50 px-6 py-4 border-b">
            <div class="flex space-x-4">
                <a href="{% url 'account_login' %}" class="text-gray-700 hover:text-blue-600">Connexion</a>
                <a href="{% url 'account_signup' %}" class="font-medium text-blue-600 border-b-2 border-blue-600">Création de compte</a>
            </div>
        </div>
        
        <!-- Corps -->
        <div class="p-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-4">Création de compte</h1>
            
            {% if form.errors %}
            <div class="bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg mb-4">
                {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                {% endfor %}
            </div>
            {% endif %}

            <form method="post" action="{% url 'account_signup' %}" class="space-y-4">
                {% csrf_token %}
                
                <!-- Redirection après succès -->
                <input type="hidden" name="next" value="{% url 'account_profile' %}" />
                
                <!-- Champ Email -->
                <div>
                    <label for="id_email" class="block text-gray-700 font-medium mb-1">E-mail :</label>
                    <input type="email" name="email" id="id_email" required autocomplete="email"
                           class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Adresse e-mail"
                           value="{{ form.email.value|default:'' }}">
                </div>
                
                <!-- Champ Prénom -->
                <div>
                    <label for="id_first_name" class="block text-gray-700 font-medium mb-1">First Name :</label>
                    <input type="text" name="first_name" id="id_first_name" required
                           class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                           placeholder=""
                           value="{{ form.first_name.value|default:'' }}">
                </div>
                
                <!-- Champ Nom -->
                <div>
                    <label for="id_last_name" class="block text-gray-700 font-medium mb-1">Last Name :</label>
                    <input type="text" name="last_name" id="id_last_name" required
                           class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                           placeholder=""
                           value="{{ form.last_name.value|default:'' }}">
                </div>
                
                <!-- Champ Rôle -->
                <div>
                    <label for="id_role" class="block text-gray-700 font-medium mb-1">Role :</label>
                    <!-- Modifiez seulement cette partie du select dans votre template -->
<select name="role" id="id_role" class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
    <option value="STUDENT" {% if form.role.value == 'STUDENT' %}selected{% endif %}>Étudiant</option>
    <option value="PROFESSOR" {% if form.role.value == 'PROFESSOR' %}selected{% endif %}>Professeur</option>
</select>
                </div>
                
                <!-- Champ Mot de passe -->
                <div>
                    <label for="id_password1" class="block text-gray-700 font-medium mb-1">Mot de passe :</label>
                    <input type="password" name="password1" id="id_password1" required autocomplete="new-password"
                           class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Mot de passe">
                </div>
                
                <!-- Aide pour le mot de passe -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm text-gray-600">
                    <ul class="list-disc pl-5 space-y-1">
                        <li>Votre mot de passe ne peut pas trop ressembler à vos autres informations personnelles.</li>
                        <li>Votre mot de passe doit contenir au minimum 8 caractères.</li>
                        <li>Votre mot de passe ne peut pas être un mot de passe couramment utilisé.</li>
                        <li>Votre mot de passe ne peut pas être entièrement numérique.</li>
                    </ul>
                </div>
                
                <!-- Confirmation mot de passe -->
                <div>
                    <label for="id_password2" class="block text-gray-700 font-medium mb-1">Mot de passe (confirmation) :</label>
                    <input type="password" name="password2" id="id_password2" required autocomplete="new-password"
                           class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Mot de passe (confirmation)">
                </div>
                
                <!-- Bouton de soumission -->
                <button type="submit" 
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition mt-4">
                    Création de compte
                </button>
            </form>
        </div>
    </div>
</div>

<script>
// Redirection immédiate après succès si besoin
{% if not form.errors and form.is_bound %}
    window.location.href = "{% url 'account_profile' %}";
{% endif %}
</script>
{% endblock %}